<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <nav>
        <a href="index.html">Home</a>
        <a href="games.html">Games</a>
        <a href="categories.html">Categories</a>
        <a href="admin.html">Admin</a>
    </nav>
</header>

<div class="container">

    <!-- LOGIN SECTION -->
    <div id="loginSection">
        <h2>Admin Login</h2>
        <input type="password" id="adminPassword" placeholder="Enter Password">
        <button class="search-btn" onclick="login()">Login</button>
    </div>

    <!-- ADMIN CONTENT -->
    <div id="adminContent" style="display:none;">

        <h2>Add / Edit Game</h2>

        <input type="hidden" id="editIndex">

        <input type="text" id="gameName" placeholder="Game Name"><br><br>
        <input type="text" id="gamePrice" placeholder="Price (THB)"><br><br>

        <input type="file" id="gameImageFile" accept="image/*"><br><br>
        <img id="previewImage" style="width:200px; display:none; margin-bottom:20px; border-radius:6px;">

        <label>Select Categories:</label><br>
        <div id="categoryCheckboxes"></div><br>

        <button class="search-btn" onclick="saveGame()">Save Game</button>

        <hr style="margin:40px 0; border-color:#222;">

        <h2>All Games</h2>
        <div id="gameList"></div>

    </div>

</div>

<footer>© 2026 Dark Game Store</footer>

<script>

const ADMIN_PASSWORD = "1234"; // เปลี่ยนรหัสได้ตรงนี้
let uploadedImageBase64 = "";

/* LOGIN */
function login() {
    const pass = document.getElementById("adminPassword").value;
    if (pass === ADMIN_PASSWORD) {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("adminContent").style.display = "block";
        loadCategories();
        loadGames();
    } else {
        alert("Wrong Password");
    }
}

/* LOAD CATEGORIES */
function loadCategories() {
    const categories = JSON.parse(localStorage.getItem("categories")) || ["horror","psychological","indie"];
    const container = document.getElementById("categoryCheckboxes");
    container.innerHTML = "";

    categories.forEach(cat => {
        container.innerHTML += `
            <label>
                <input type="checkbox" value="${cat}"> ${cat}
            </label><br>
        `;
    });
}

/* IMAGE UPLOAD */
document.getElementById("gameImageFile").addEventListener("change", function(event) {

    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        uploadedImageBase64 = e.target.result;
        const preview = document.getElementById("previewImage");
        preview.src = uploadedImageBase64;
        preview.style.display = "block";
    };

    reader.readAsDataURL(file);
});

/* SAVE GAME (ADD OR EDIT) */
function saveGame() {

    const name = document.getElementById("gameName").value;
    const price = document.getElementById("gamePrice").value;
    const editIndex = document.getElementById("editIndex").value;

    const selected = document.querySelectorAll("#categoryCheckboxes input:checked");
    let cats = [];
    selected.forEach(cb => cats.push(cb.value));

    if (!name || !price) {
        alert("Please fill name and price");
        return;
    }

    let games = JSON.parse(localStorage.getItem("games")) || [];

    const gameData = {
        name,
        price,
        image: uploadedImageBase64 || (games[editIndex] ? games[editIndex].image : ""),
        categories: cats
    };

    if (editIndex === "") {
        games.push(gameData);
    } else {
        games[editIndex] = gameData;
    }

    localStorage.setItem("games", JSON.stringify(games));

    resetForm();
    loadGames();
}

/* LOAD GAME LIST */
function loadGames() {

    const games = JSON.parse(localStorage.getItem("games")) || [];
    const container = document.getElementById("gameList");
    container.innerHTML = "";

    games.forEach((game, index) => {
        container.innerHTML += `
            <div class="card">
                <img src="${game.image}" style="width:120px;"><br>
                <strong>${game.name}</strong><br>
                ${game.price} THB<br>
                ${game.categories.join(", ")}<br><br>
                <button onclick="editGame(${index})">Edit</button>
                <button onclick="deleteGame(${index})" style="background:#800;">Delete</button>
            </div>
        `;
    });
}

/* EDIT */
function editGame(index) {
    const games = JSON.parse(localStorage.getItem("games")) || [];
    const game = games[index];

    document.getElementById("gameName").value = game.name;
    document.getElementById("gamePrice").value = game.price;
    document.getElementById("editIndex").value = index;

    uploadedImageBase64 = game.image;
    const preview = document.getElementById("previewImage");
    preview.src = game.image;
    preview.style.display = "block";

    const checkboxes = document.querySelectorAll("#categoryCheckboxes input");
    checkboxes.forEach(cb => {
        cb.checked = game.categories.includes(cb.value);
    });
}

/* DELETE */
function deleteGame(index) {
    if (!confirm("Delete this game?")) return;

    let games = JSON.parse(localStorage.getItem("games")) || [];
    games.splice(index, 1);
    localStorage.setItem("games", JSON.stringify(games));

    loadGames();
}

/* RESET FORM */
function resetForm() {
    document.getElementById("gameName").value = "";
    document.getElementById("gamePrice").value = "";
    document.getElementById("editIndex").value = "";
    document.getElementById("gameImageFile").value = "";
    document.getElementById("previewImage").style.display = "none";
    uploadedImageBase64 = "";

    const checkboxes = document.querySelectorAll("#categoryCheckboxes input");
    checkboxes.forEach(cb => cb.checked = false);
}

</script>

</body>
</html>
